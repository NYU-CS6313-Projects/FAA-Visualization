!function(){function a(a){s="<p>"+a.category+"</p>",hoveredBar=d3.select(this),d3.selectAll(".g rect").filter(function(b){return b!==a}).style("opacity",.3),d3.select("#hello").html(s)}function b(){d3.selectAll(".g rect").style("opacity",1)}function c(c){function d(c){barChartData.forEach(function(a){a.categories=c.map(function(b){return{category:b,value:+a[b]}})}),n.domain(j.concat("0 - 199").concat("200 - 399").concat("400 - 599").concat("600 - 799").concat("800 - 999").concat("1000+")),o.domain(c).rangeRoundBands([0,n.rangeBand()]),p.domain([0,d3.max(barChartData,function(a){return d3.max(a.categories,function(a){return a.value})})]),h.selectAll(".x.axis").transition().duration(800).call(r),h.selectAll(".y.axis").transition().duration(800).call(t);var d=h.selectAll(".g").data(barChartData).attr("transform",function(a){return"translate("+n(a.bin)+",0)"}).selectAll("rect").data(function(a){return a.categories}).attr("width",o.rangeBand()).attr("x",function(a){return o(a.category)}).attr("y",function(a){return p(a.value)}).attr("height",function(a){return m-p(a.value)}).style("fill",function(a){return q(a.category)});d.enter().append("rect").attr("width",o.rangeBand()).attr("x",function(a){return o(a.category)}).attr("y",function(a){return p(a.value)}).attr("height",function(a){return m-p(a.value)}).style("fill",function(a){return q(a.category)}).on("mouseover",a).on("mouseout",b),d.exit().remove()}function e(a){var b=h.select(".legend-group").selectAll(".legend").data(a.slice(),function(a){return a}).attr("transform",function(a,b){return"translate(-100,"+12*b+")"});enter_legend=b.enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(-100,"+12*b+")"}),enter_legend.append("rect").attr("x",l-18).attr("width",10).attr("height",10).style("fill",q),enter_legend.append("text").attr("x",l-24).attr("y",6).attr("dy",".35em").attr("font-size","10px").style("text-anchor","end").text(function(a){return a}),b.exit().remove()}return input_checked_count=d3.nest().key(function(a){return a.checked===!0?"true":"false"}).rollup(function(a){return a.length}).map(d3.selectAll('input[name="accident_type"]')[0]),input_checked_count["true"]>6?(d3.select(this).property("checked",!1),void alert("Cannot exceed six checked options.")):void(d3.select(this).property("checked")===!0?(g.push(d3.select(this)[0][0].__data__),e(g),d(g)):(g.splice(g.indexOf(d3.select(this)[0][0].__data__),1),e(g),d(g)))}function d(d,s){h=d3.select("#bar-charts").append("svg").attr("width",l+k.left+k.right).attr("height",m+k.top+k.bottom).append("g").attr("transform","translate("+k.left+","+k.top+")"),d3.csv("../data/part_91_csv/data_1980_84.csv",function(k,u){function v(a,b,c,d,e,f){var g=[];for(var h in a)h in b&&h in c&&h in d&&h in e&&h in f&&"null"!==h&&"bin"!==h&&(g.push(h),i[h]=0);return g}e=d3.nest().key(function(a){return 0<=a[d]&&a[d]<200?"0 - 199":200<=a[d]&&a[d]<400?"200 - 399":400<=a[d]&&a[d]<600?"400 - 599":600<=a[d]&&a[d]<800?"600 - 799":800<=a[d]&&a[d]<1e3?"800 - 999":"1000+"}).key(function(a){return a.primary_cause}).sortKeys(d3.ascending).rollup(function(a){return a.length}).entries(u),f=e.map(function(a){var b={};b.bin=a.key;for(var c=0;c<a.values.length;c++)b[a.values[c].key]=a.values[c].values;return b}),console.log(e),commonKeyValues=v(f[0],f[1],f[2],f[3],f[4],f[5]),barChartData=f.map(function(a){var b={};b.bin=a.bin;for(var c=0;c<commonKeyValues.length;c++)b[commonKeyValues[c]]=a[commonKeyValues[c]],i[commonKeyValues[c]]+=a[commonKeyValues[c]];return b}),console.log(e),console.log(f),console.log(commonKeyValues),console.log(barChartData),console.log(i),g=commonKeyValues.filter(function(a,b){return 0===b||1===b||2===b||3===b||4===b||5===b}),barChartData.forEach(function(a){a.categories=g.map(function(b){return{category:b,value:+a[b]}})}),n.domain(j.concat("0 - 199").concat("200 - 399").concat("400 - 599").concat("600 - 799").concat("800 - 999").concat("1000+")),o.domain(g).rangeRoundBands([0,n.rangeBand()]),p.domain([0,d3.max(barChartData,function(a){return d3.max(a.categories,function(a){return a.value})})]),h.append("g").attr("class","x axis").attr("transform","translate(0,"+m+")").call(r).append("text").attr("y",24).attr("dy",".71em").attr("x",l/2).style("text-anchor","end").style("z-index",999).text(s),h.append("g").attr("class","y axis").call(t).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").style("z-index",999).text("Frequency");var w=h.selectAll(".bins").data(barChartData).enter().append("g").attr("class","g").attr("transform",function(a){return"translate("+n(a.bin)+",0)"}),x=(w.selectAll("rect").data(function(a){return a.categories}).enter().append("rect").attr("width",o.rangeBand()).attr("x",function(a){return o(a.category)}).attr("y",function(a){return p(a.value)}).attr("height",function(a){return m-p(a.value)}).style("fill",function(a){return q(a.category)}).on("mouseover",a).on("mouseout",b),h.append("g").attr("class","legend-group").selectAll(".legend").data(g.slice()).enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(-100,"+12*b+")"}));x.append("rect").attr("x",l-18).attr("width",10).attr("height",10).style("fill",q),x.append("text").attr("x",l-24).attr("y",6).attr("dy",".35em").attr("font-size","10px").style("text-anchor","end").text(function(a){return a}),inputs=d3.select("#dropdown3").selectAll("input").data(commonKeyValues).enter().append("li").append("a").text(function(a){return a+" ("+i[a]+")"}).append("input").attr("type","checkbox").attr("name","accident_type").attr("value",function(a){return a}).style("left","515px").property("checked",function(a,b){return 0===b||1===b||2===b||3===b||4===b||5===b?!0:!1}).on("click",c)})}var e,f,g,h,i={},j=[],k={top:5,right:5,bottom:30,left:40},l=475-k.left-k.right,m=500-k.top-k.bottom,n=d3.scale.ordinal().rangeRoundBands([0,l],.1),o=d3.scale.ordinal(),p=d3.scale.linear().range([m,0]),q=d3.scale.ordinal().range(["#98abc5","#8a89a6","#7b6888","#6b486b","#a05d56","#d0743c","#ff8c00"]),r=d3.svg.axis().scale(n).orient("bottom"),t=d3.svg.axis().scale(p).orient("left").tickFormat(d3.format(".2s"));d("total_hours_flown","Total Hours Flown"),d3.selectAll("#total-hours-flown, #total-hours-flown-ninety, #total-hours-flown-make, #total-hours-flown-ninety-make").on("click",function(){d3.select("#bar-charts").select("svg").remove(),$("#total-hours-flown").is(":checked")&&d("total_hours_flown","Total Hours Flown"),$("#total-hours-flown-ninety").is(":checked")&&d("hours_flown_90_days","Total Hours Flown (Past 90 Days)"),$("#total-hours-flown-make").is(":checked")&&d("total_hours_model_flown","Total Hours Flown - Make/Model"),$("#total-hours-flown-ninety-make").is(":checked")&&d("hours_model_flown_90_days","Total Hours Flown (Past 90 Days) - Make/Model")}),$(document).mouseup(function(a){var b=$("#dropdown3");b.is(a.target)||0!==b.has(a.target).length||b.hide()})}();