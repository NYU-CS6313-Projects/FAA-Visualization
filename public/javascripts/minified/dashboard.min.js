!function(){function a(a){var b=new Date(a.getFullYear(),a.getMonth()+1,0),c=+j(a),d=+k(a),e=+j(b),f=+k(b);return"M"+(d+1)*i+","+c*i+"H"+d*i+"V"+7*i+"H"+f*i+"V"+(e+1)*i+"H"+(f+1)*i+"V0H"+(d+1)*i+"Z"}var b,c,d=37,e=44,f={},g=750,h=100,i=13,j=d3.time.format("%w"),k=d3.time.format("%U"),l=d3.time.format("%Y-%m-%d"),m=d3.scale.quantile().domain([1,d]).range(d3.range(1,9).map(function(a){return"q-color"+a+"-10"}));console.log(m(30));var n=d3.scale.quantile().domain([1,e]).range(d3.range(1,9).map(function(a){return"q-color"+a+"-10"})),o=d3.select("#heatmap-panel").selectAll("svg").data(d3.range(1980,1985)).enter().append("svg").attr("width",g).attr("height",h).attr("class","RdYlGn").append("g").attr("transform","translate("+(g-53*i)/2+","+(h-7*i-1)+")");o.append("text").attr("transform","translate(-6,"+3.5*i+")rotate(-90)").style("text-anchor","middle").text(function(a){return a});var p=o.selectAll(".day").data(function(a){return d3.time.days(new Date(a,0,1),new Date(a+1,0,1))}).enter().append("rect").attr("class","day").attr("width",i).attr("height",i).attr("x",function(a){return k(a)*i}).attr("y",function(a){return j(a)*i}).datum(l);p.append("title").text(function(a){return a}),o.selectAll(".month").data(function(a){return d3.time.months(new Date(a,0,1),new Date(a+1,0,1))}).enter().append("path").attr("class","month").attr("d",a),d3.csv("../data/part_91_csv/data_1980_84.csv",function(a,d){d.forEach(function(a){a.date in f?f[a.date].push(a):f[a.date]=[]}),c=d3.nest().key(function(a){return a.date}).rollup(function(a){return fatality_sum=d3.sum(a,function(a){return null!==a.fatalities?(fatalities=parseInt(a.fatalities),fatalities):0}),fatality_sum}).map(d),b=d3.nest().key(function(a){return a.date}).rollup(function(a){return a.length}).map(d),category_data=d3.nest().key(function(a){return a.primary_cause}).rollup(function(a){return a.length}).map(d),p.filter(function(a){return a in c}).attr("class",function(a){return 0===c[a]?"month-"+a.substring(5,7)+" day q-color0-10":"month-"+a.substring(5,7)+" day "+m(c[a])}).select("title").text(function(a){return 0==c[a]?a+": No fatalities!":1==c[a]?a+": "+c[a]+" fatality":a+": "+c[a]+" fatalities"})}),d3.select(self.frameElement).style("height","2910px");var q=function(){function a(a,d){var e;switch(a){case"#fatalities":console.log("inside case fatalities"),e=c,color=m;break;case"#accidents":console.log("inside case accidents"),e=b,color=n}d(e,color)}function d(a,b,c){console.log("inside default"),p.filter(function(b){return b in a}).attr("class",function(c){return 0===a[c]?"month-"+c.substring(5,7)+" day q-color0-10":"month-"+c.substring(5,7)+" day "+b(a[c])}).select("title").text(function(b){switch(c){case"#fatalities":return 0==a[b]?b+": No fatalities!":1==a[b]?b+": "+a[b]+" fatality":b+": "+a[b]+" fatalities";case"#accidents":return 0==a[b]?b+": No accidents!":1==a[b]?b+": "+a[b]+" accident":b+": "+a[b]+" accidents"}})}d3.selectAll("#accidents, #fatalities").on("click",function(){$("#accidents").is(":checked")&&a("#accidents",function(a,b){d(a,b,"#accidents")}),$("#fatalities").is(":checked")&&a("#fatalities",function(a,b){d(a,b,"#fatalities")})})};q(),d3.selectAll(".day").on("click",function(a){s=JSON.stringify(f[a]),d3.select(".cd-panel-content").html(s)}),$("#slider").bind("valuesChanging",function(a,b){var c=b.values.min,d=b.values.max;d3.selectAll(".day").filter(function(a){var b=Date.parse(a);return b>=c&&d>=b?d3.select(this).classed("q-invisible",!1):d3.select(this).classed("q-invisible",!0)})}),$("#weekday-dropdown.btn.dropdown-button").click(function(){$("ul#dropdown1").show(),$("ul#dropdown1").css({opacity:1})}),$("#month-dropdown.btn.dropdown-button").click(function(){$("ul#dropdown2").show(),$("ul#dropdown2").css({opacity:1})}),$("#accident-type-dropdown.btn.dropdown-button").click(function(){$("ul#dropdown3").show(),$("ul#dropdown3").css({opacity:1})}),$("ul#dropdown1 li a").click(function(a){$("#weekday-dropdown.btn.dropdown-button span").text($(this).text()),$("ul#dropdown1").hide(),$("ul#dropdown1").css({opacity:0})}),$("ul#dropdown2 li a").click(function(a){$("#month-dropdown.btn.dropdown-button span").text($(this).text()),$("ul#dropdown2").hide(),$("ul#dropdown2").css({opacity:0})}),$("ul#dropdown1 li").click(function(){switch($(this).text()){case"Weekday":d3.selectAll("rect.day").style("opacity",1);break;case"Sunday":d3.selectAll("rect.day").style("opacity",function(a){return console.log(d3.select(this).attr("y")),0==d3.select(this).attr("y")?1:.1});break;case"Monday":d3.selectAll("rect.day").style("opacity",function(a){return 13==d3.select(this).attr("y")?1:.1});break;case"Tuesday":d3.selectAll("rect.day").style("opacity",function(a){return 26==d3.select(this).attr("y")?1:.1});break;case"Wednesday":d3.selectAll("rect.day").style("opacity",function(a){return 39==d3.select(this).attr("y")?1:.1});break;case"Thursday":d3.selectAll("rect.day").style("opacity",function(a){return 52==d3.select(this).attr("y")?1:.1});break;case"Friday":d3.selectAll("rect.day").style("opacity",function(a){return 65==d3.select(this).attr("y")?1:.1});break;case"Saturday":d3.selectAll("rect.day").style("opacity",function(a){return 78==d3.select(this).attr("y")?1:.1})}}),$("ul#dropdown2 li").click(function(){switch($(this).text()){case"Month":d3.selectAll("rect.day").style("opacity",1);break;case"January":d3.selectAll("rect.day").style("opacity",function(a){return d3.select(this).classed("month-01")?1:.1});break;case"February":d3.selectAll("rect.day").style("opacity",function(a){return d3.select(this).classed("month-02")?1:.1});break;case"March":d3.selectAll("rect.day").style("opacity",function(a){return d3.select(this).classed("month-03")?1:.1});break;case"April":d3.selectAll("rect.day").style("opacity",function(a){return d3.select(this).classed("month-04")?1:.1});break;case"May":d3.selectAll("rect.day").style("opacity",function(a){return d3.select(this).classed("month-05")?1:.1});break;case"June":d3.selectAll("rect.day").style("opacity",function(a){return d3.select(this).classed("month-06")?1:.1});break;case"July":d3.selectAll("rect.day").style("opacity",function(a){return d3.select(this).classed("month-07")?1:.1});break;case"August":d3.selectAll("rect.day").style("opacity",function(a){return d3.select(this).classed("month-08")?1:.1});break;case"September":d3.selectAll("rect.day").style("opacity",function(a){return d3.select(this).classed("month-09")?1:.1});break;case"October":d3.selectAll("rect.day").style("opacity",function(a){return d3.select(this).classed("month-10")?1:.1});break;case"November":d3.selectAll("rect.day").style("opacity",function(a){return d3.select(this).classed("month-11")?1:.1});break;case"December":d3.selectAll("rect.day").style("opacity",function(a){return d3.select(this).classed("month-12")?1:.1})}})}();