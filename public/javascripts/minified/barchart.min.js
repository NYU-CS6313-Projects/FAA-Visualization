var barChartModule=function(){"use strict";var a,b,c,d,e,f,g={},h={},i=[],j={top:5,right:5,bottom:30,left:40},k=475-j.left-j.right,l=510-j.top-j.bottom,m=d3.scale.ordinal().rangeRoundBands([0,k],.1),n=d3.scale.ordinal(),o=d3.scale.linear().range([l,0]),p=d3.scale.ordinal().range(["#B2182B","#E08214","#676767","#EF8A62","#D8B365","#999999"]),q={"#B2182B":!0,"#E08214":!0,"#676767":!0,"#EF8A62":!0,"#D8B365":!0,"#999999":!0},r=d3.svg.axis().scale(m).orient("bottom"),s=d3.svg.axis().scale(o).orient("left").tickFormat(d3.format(".2s")),t=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(a){return"<strong>Frequency:</strong> <span style='color:red'>"+a.frequency+"</span>"});return g.create=function(g,u){function v(a){d3.selectAll(".g rect").filter(function(b){return b!==a}).style("opacity",.2)}function w(){d3.selectAll(".g rect").style("opacity",1)}function x(a){function b(a){d.forEach(function(b){b.categories=a.map(function(a){return{category:a,frequency:+b[a]}})}),m.domain(i.concat("0 - 199").concat("200 - 399").concat("400 - 599").concat("600 - 799").concat("800 - 999").concat("1000+")),n.domain(a).rangeRoundBands([0,m.rangeBand()]),o.domain([0,d3.max(d,function(a){return d3.max(a.categories,function(a){return a.frequency})})]),e.selectAll(".x.axis").transition().duration(800).call(r),e.selectAll(".y.axis").transition().duration(800).call(s);var b=e.selectAll(".g").data(d).attr("transform",function(a){return"translate("+m(a.bin)+",0)"}).selectAll("rect").data(function(a){return a.categories}).attr("width",n.rangeBand()).attr("x",function(a){return n(a.category)}).attr("y",function(a){return o(a.frequency)}).attr("height",function(a){return l-o(a.frequency)}).style("fill",function(a){return p(a.category)});b.enter().append("rect").attr("width",n.rangeBand()).attr("x",function(a){return n(a.category)}).attr("y",function(a){return o(a.frequency)}).attr("height",function(a){return l-o(a.frequency)}).style("fill",function(a){return p(a.category)}).on("mouseover",function(a){t.show(a),v(a)}).on("mouseout",function(a){t.hide(a),w(a)}),b.exit().remove()}function f(a){var b=e.select(".legend-group").selectAll(".legend").data(a.slice(),function(a){return a}).attr("transform",function(a,b){return"translate(-100,"+12*b+")"}),c=b.enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(-100,"+12*b+")"});c.append("rect").attr("x",k-18).attr("width",10).attr("height",10).style("fill",p),c.append("text").attr("x",k-24).attr("y",6).attr("dy",".35em").attr("font-size","10px").style("text-anchor","end").text(function(a){return a}).attr("fill","#9e9e9e"),b.exit().remove()}var g=d3.nest().key(function(a){return a.checked===!0?"true":"false"}).rollup(function(a){return a.length}).map(d3.selectAll('input[name="accident_type"]')[0]);return g["true"]>6?(d3.select(this).property("checked",!1),void alert("Cannot exceed six checked options.")):void(d3.select(this).property("checked")===!0?(c.push(d3.select(this)[0][0].__data__),f(c),b(c)):(c.splice(c.indexOf(d3.select(this)[0][0].__data__),1),f(c),b(c)))}function y(y,z,A){e=d3.select("#side-view").append("svg").attr("width",k+j.left+j.right).attr("height",l+j.top+j.bottom).append("g").attr("transform","translate("+j.left+","+j.top+")"),e.call(t),d3.csv(csv_path,function(j,B){function C(a,b,c,d,e,f){var g=[];for(var i in a)"null"!==i&&"bin"!==i&&(g.push(i),h[i]=0);for(var i in b)"null"===i||"bin"===i||i in a||(g.push(i),h[i]=0);for(var i in c)"null"===i||"bin"===i||i in a||i in b||(g.push(i),h[i]=0);for(var i in d)"null"===i||"bin"===i||i in a||i in b||i in c||(g.push(i),h[i]=0);for(var i in e)"null"===i||"bin"===i||i in a||i in b||i in c||i in d||(g.push(i),h[i]=0);for(var i in f)"null"===i||"bin"===i||i in a||i in b||i in c||i in d||i in e||(g.push(i),h[i]=0);return g.sort()}function D(a,b,c,d,e,f){return void 0==b&&void 0==c&&void 0==d&&void 0==e&&void 0==f?Object.keys(a).filter(function(a){return"null"!==a&&"bin"!==a}).reduce(function(b,c){return a[b]>a[c]?b:c}):Object.keys(a).filter(function(a){return"null"!==a&&"bin"!==a&&a!==b&&a!==c&&a!==d&&a!==e&&a!==f}).reduce(function(b,c){return a[b]>a[c]?b:c})}f=B,void 0!=g&&void 0!=u&&(f=f.filter(function(a){var b=Date.parse(a.date);return b>=g&&u>=b?a:void 0}));var E={"0 - 199":0,"200 - 399":0,"400 - 599":0,"600 - 799":0,"800 - 999":0,"1000+":0,Unknown:0};a=d3.nest().key(function(a){return 0<=a[y]&&a[y]<200?(E["0 - 199"]+=1,"0 - 199"):200<=a[y]&&a[y]<400?(E["200 - 399"]+=1,"200 - 399"):400<=a[y]&&a[y]<600?(E["400 - 599"]+=1,"400 - 599"):600<=a[y]&&a[y]<800?(E["600 - 799"]+=1,"600 - 799"):800<=a[y]&&a[y]<1e3?(E["800 - 999"]+=1,"800 - 999"):a[y]>=1e3?(E["1000+"]+=1,"1000+"):(E.Unknown+=1,"Unknown")}).key(function(a){return a.primary_cause}).sortKeys(d3.ascending).rollup(function(a){return a.length}).entries(f),0==E["0 - 199"]&&a.push({key:"0 - 199",values:[{key:"Advanced Throttle Rapidly",values:0},{key:"Aerobatics Below Safe Altitude",values:0},{key:"Aircraft Improperly Aligned With Runway",values:0},{key:"Aircraft Improperly Equipped for Flight",values:0},{key:"Attempt Operation With Different Equipment",values:0},{key:"Attempted Operations Beyond Experience Level",values:0},{key:"Blown Over By Strong Wind",values:0}]}),0==E["200 - 399"]&&a.push({key:"200 - 399",values:[{key:"Advanced Throttle Rapidly",values:0},{key:"Aerobatics Below Safe Altitude",values:0},{key:"Aircraft Improperly Aligned With Runway",values:0},{key:"Aircraft Improperly Equipped for Flight",values:0},{key:"Attempt Operation With Different Equipment",values:0},{key:"Attempted Operations Beyond Experience Level",values:0},{key:"Blown Over By Strong Wind",values:0}]}),0==E["400 - 599"]&&a.push({key:"400 - 599",values:[{key:"Advanced Throttle Rapidly",values:0},{key:"Aerobatics Below Safe Altitude",values:0},{key:"Aircraft Improperly Aligned With Runway",values:0},{key:"Aircraft Improperly Equipped for Flight",values:0},{key:"Attempt Operation With Different Equipment",values:0},{key:"Attempted Operations Beyond Experience Level",values:0},{key:"Blown Over By Strong Wind",values:0}]}),0==E["600 - 799"]&&a.push({key:"600 - 799",values:[{key:"Advanced Throttle Rapidly",values:0},{key:"Aerobatics Below Safe Altitude",values:0},{key:"Aircraft Improperly Aligned With Runway",values:0},{key:"Aircraft Improperly Equipped for Flight",values:0},{key:"Attempt Operation With Different Equipment",values:0},{key:"Attempted Operations Beyond Experience Level",values:0},{key:"Blown Over By Strong Wind",values:0}]}),0==E["800 - 999"]&&a.push({key:"800 - 999",values:[{key:"Advanced Throttle Rapidly",values:0},{key:"Aerobatics Below Safe Altitude",values:0},{key:"Aircraft Improperly Aligned With Runway",values:0},{key:"Aircraft Improperly Equipped for Flight",values:0},{key:"Attempt Operation With Different Equipment",values:0},{key:"Attempted Operations Beyond Experience Level",values:0},{key:"Blown Over By Strong Wind",values:0}]}),0==E["1000+"]&&a.push({key:"1000+",values:[{key:"Advanced Throttle Rapidly",values:0},{key:"Aerobatics Below Safe Altitude",values:0},{key:"Aircraft Improperly Aligned With Runway",values:0},{key:"Aircraft Improperly Equipped for Flight",values:0},{key:"Attempt Operation With Different Equipment",values:0},{key:"Attempted Operations Beyond Experience Level",values:0},{key:"Blown Over By Strong Wind",values:0}]}),0==E.Unknown&&a.push({key:"Unknown",values:[{key:"Advanced Throttle Rapidly",values:0},{key:"Aerobatics Below Safe Altitude",values:0},{key:"Aircraft Improperly Aligned With Runway",values:0},{key:"Aircraft Improperly Equipped for Flight",values:0},{key:"Attempt Operation With Different Equipment",values:0},{key:"Attempted Operations Beyond Experience Level",values:0},{key:"Blown Over By Strong Wind",values:0}]}),a=a.filter(function(a){return 1==a.values.length&&"null"==a.values[0].key?(a.values.push({key:"Advanced Throttle Rapidly",values:0},{key:"Aerobatics Below Safe Altitude",values:0},{key:"Aircraft Improperly Aligned With Runway",values:0},{key:"Aircraft Improperly Equipped for Flight",values:0},{key:"Attempt Operation With Different Equipment",values:0},{key:"Attempted Operations Beyond Experience Level",values:0},{key:"Blown Over By Strong Wind",values:0}),a):a}),b=a.filter(function(a){return"Unknown"!=a.key}).map(function(a){var b={};b.bin=a.key;for(var c=0;c<a.values.length;c++)b[a.values[c].key]=a.values[c].values;return b});var F=D(b[0]),G=D(b[1],F),H=D(b[2],F,G),I=D(b[3],F,G,H),J=D(b[4],F,G,H,I),K=D(b[5],F,G,H,I,J),L=C(b[0],b[1],b[2],b[3],b[4],b[5]);if(d=b.map(function(a){var b={};b.bin=a.bin;for(var c=0;c<L.length;c++)void 0==a[L[c]]?(b[L[c]]=0,h[L[c]]+=0):(b[L[c]]=a[L[c]],h[L[c]]+=a[L[c]]);return b}),void 0==A){c=L.filter(function(a,b){return a===F||a===G||a===H||a===I||a===J||a===K});for(var M={},N=0,O=c.length;O>N;N++)M[c[N]]=!0;d.forEach(function(a){a.categories=c.map(function(b){return{category:b,frequency:+a[b]}})})}else{c=L.filter(function(a,b){return a in A});for(var M={},N=0,O=c.length;O>N;N++)M[c[N]]=!0;d.forEach(function(a){a.categories=c.map(function(b){return{category:b,frequency:+a[b]}})})}m.domain(i.concat("0 - 199").concat("200 - 399").concat("400 - 599").concat("600 - 799").concat("800 - 999").concat("1000+")),n.domain(c).rangeRoundBands([0,m.rangeBand()]),o.domain([0,d3.max(d,function(a){return d3.max(a.categories,function(a){return a.frequency})})]),e.append("g").attr("class","x axis").attr("transform","translate(0,"+l+")").call(r).append("text").attr("y",24).attr("dy",".5em").attr("x",k/2+50).style("text-anchor","end").style("z-index",999).text(z).attr("fill","#9e9e9e"),e.append("g").attr("class","y axis").call(s).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".01em").style("text-anchor","end").style("z-index",999).text("Frequency").attr("fill","#9e9e9e");var P=e.selectAll(".bins").data(d).enter().append("g").attr("class","g").attr("transform",function(a){return"translate("+m(a.bin)+",0)"}),Q=(P.selectAll("rect").data(function(a){return a.categories}).enter().append("rect").attr("width",n.rangeBand()).attr("x",function(a){return n(a.category)}).attr("y",function(a){return o(a.frequency)}).attr("height",function(a){return l-o(a.frequency)}).style("fill",function(a){return p(a.category)in q&&(q[p(a.category)]=!0),p(a.category)}).on("mouseover",function(a){t.show(a),v(a)}).on("mouseout",function(a){t.hide(a),w(a)}),e.append("g").attr("class","legend-group").selectAll(".legend").data(c.slice(),function(a){return a}).enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(-100,"+12*b+")"}));Q.append("rect").attr("x",k-18).attr("width",10).attr("height",10).style("fill",p),Q.append("text").attr("x",k-24).attr("y",6).attr("dy",".35em").attr("font-size","10px").style("text-anchor","end").text(function(a){return a}).attr("fill","#9e9e9e");var R=d3.select("#dropdown3").selectAll("li").data(L,function(a){return a}),S=R.enter().append("li"),T=S.append("a").text(function(a){return a+" ("+h[a]+")"});T.append("input").attr("type","checkbox").attr("name","accident_type").attr("value",function(a){return a}).style("left","7px").style("margin-top","6px").on("click",x),d3.selectAll("#dropdown3 li input").property("checked",function(a,b){return a in M?!0:!1}),R.exit().remove()})}y("total_hours_flown","Total Hours Flown"),d3.selectAll("#total-hours-flown, #total-hours-flown-ninety, #total-hours-flown-make, #total-hours-flown-ninety-make").on("click",function(){var a={};d3.select("#side-view").select(".legend-group").remove(),d3.select("#side-view").select("svg").remove(),$("#total-hours-flown").is(":checked")&&(d3.selectAll("#dropdown3 li input").filter(function(b){d3.select(this).property("checked")&&(a[d3.select(this)[0][0].__data__]=!0)}),y("total_hours_flown","Total Hours Flown",a)),$("#total-hours-flown-ninety").is(":checked")&&(d3.selectAll("#dropdown3 li input").filter(function(b){d3.select(this).property("checked")&&(a[d3.select(this)[0][0].__data__]=!0)}),y("hours_flown_90_days","Total Hours Flown (Past 90 Days)",a)),$("#total-hours-flown-make").is(":checked")&&(d3.selectAll("#dropdown3 li input").filter(function(b){d3.select(this).property("checked")&&(a[d3.select(this)[0][0].__data__]=!0)}),y("total_hours_model_flown","Total Hours Flown - Make/Model",a)),$("#total-hours-flown-ninety-make").is(":checked")&&(d3.selectAll("#dropdown3 li input").filter(function(b){d3.select(this).property("checked")&&(a[d3.select(this)[0][0].__data__]=!0)}),y("hours_model_flown_90_days","Total Hours Flown (Past 90 Days) - Make/Model",a))}),$(document).mouseup(function(a){var b=$("#dropdown3");b.is(a.target)||0!==b.has(a.target).length||b.hide()})},g}();