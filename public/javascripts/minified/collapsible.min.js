var collapsibleTreeModule=function(){"use strict";var a={};return a.create=function(a){function b(a){a.children&&(a.children.forEach(function(a){b(a)}),a._children=a.children,a.children=null)}function c(a){var b=q.nodes(i),c=Math.max(500,b.length*m+k.top+k.bottom);d3.select("#flare-tree").transition().duration(p).attr("height",c),d3.select(self.frameElement).transition().duration(p).style("height",c+"px"),b.forEach(function(a,b){a.x=b*m});var g=s.selectAll("g.node").data(b,function(a){return a.id||(a.id=++o)}),h=g.enter().append("g").attr("class",function(a){return a["class"]+" node"}).attr("transform",function(b){return"translate("+a.y0+","+a.x0+")"}).style("opacity",1e-6);h.append("rect").attr("y",-m/2).attr("height",m).attr("width",n).style("fill",e).on("click",d).on("mouseover",f),h.append("text").attr("dy",3.5).attr("dx",5.5).text(function(a){return a.name}),h.transition().duration(p).attr("transform",function(a){return"translate("+a.y+","+a.x+")"}).style("opacity",1),g.select("text").text(function(a){return a.children?"- "+a.name:a._children?"+ "+a.name:a.name}),g.transition().duration(p).attr("transform",function(a){return"translate("+a.y+","+a.x+")"}).style("opacity",1).select("rect").style("fill",e),g.exit().transition().duration(p).attr("transform",function(b){return"translate("+a.y+","+a.x+")"}).style("opacity",1e-6).remove();var j=s.selectAll("path.link").data(q.links(b),function(a){return a.target.id});j.enter().insert("path","g").attr("class","link").attr("d",function(b){var c={x:a.x0,y:a.y0};return r({source:c,target:c})}).transition().duration(p).attr("d",r),j.transition().duration(p).attr("d",r),j.exit().transition().duration(p).attr("d",function(b){var c={x:a.x,y:a.y};return r({source:c,target:c})}).remove(),b.forEach(function(a){a.x0=a.x,a.y0=a.y})}function d(a){a.children?(a._children=a.children,a.children=null):(a.children=a._children,a._children=null),c(a)}function e(a){return a._children?"#b7b7b7":(a.children,"whitesmoke")}function f(a){a.name.indexOf("Remarks")>=0&&d3.select("#remarks-box").html("<h5>Full Remarks: </h5><div>"+h[a.name.substring(9)].text+"</div>")}var g,h={};g=a[a.length-1].date!=a[0].date?a[0].date+" to "+a[a.length-1].date:a[0].date;var i,j={name:"List of events that occurred on: "+g,children:[],"class":"parent"},k=(d3.nest().key(function(a){return a.primary_cause}).rollup(function(a){return a}).entries(a).filter(function(a,b){"null"==a.key&&(a.key="Unknown Cause"),j.children.push({name:a.key+": "+a.values.length,children:[],"class":"parent"});for(var c=0;c<a.values.length;c++){a.values[c].name="Event: "+c,j.children[b].children.push({name:a.values[c].name,children:[],"class":"parent"});for(var d in a.values[c]){var e,f;if("name"!==d)switch((null==a.values[c][d]||"null"==a.values[c][d])&&(a.values[c][d]="Unknown"),d){case"date":f="Date",j.children[b].children[c].children.push({name:f+": "+a.values[c][d],"class":"child"});break;case"state":f="State",j.children[b].children[c].children.push({name:f+": "+a.values[c][d],"class":"child"});break;case"city":f="City",j.children[b].children[c].children.push({name:f+": "+a.values[c][d],"class":"child"});break;case"weather":f="Weather",j.children[b].children[c].children.push({name:f+": "+a.values[c][d],"class":"child"});break;case"light":f="Light Condition",j.children[b].children[c].children.push({name:f+": "+a.values[c][d],"class":"child"});break;case"visibility":f="Visibility (in Miles)",j.children[b].children[c].children.push({name:f+": "+a.values[c][d],"class":"child"});break;case"fatalities":f="Fatalities",j.children[b].children[c].children.push({name:f+": "+a.values[c][d],"class":"child"});break;case"primary_cause":f="Primary Cause",j.children[b].children[c].children.push({name:f+": "+a.values[c][d],"class":"child"});break;case"type":f="Type of Accident",j.children[b].children[c].children.push({name:f+": "+a.values[c][d],"class":"child"});break;case"pilot_age":f="Pilot Age (in Years)",j.children[b].children[c].children.push({name:f+": "+a.values[c][d],"class":"child"});break;case"total_hours_model_flown":f="Total Number of Hours Flown Given Model",j.children[b].children[c].children.push({name:f+": "+a.values[c][d],"class":"child"});break;case"hours_model_flown_90_days":f="Total Number of Hours Flown Given Model (Past 90 Days)",j.children[b].children[c].children.push({name:f+": "+a.values[c][d],"class":"child"});break;case"hours_flown_90_days":f="Total Number of Hours Flown (Past 90 Days)",j.children[b].children[c].children.push({name:f+": "+a.values[c][d],"class":"child"});break;case"total_hours_flown":f="Total Number of Hours Flown",j.children[b].children[c].children.push({name:f+": "+a.values[c][d],"class":"child"});break;case"pilot_certification":f="Pilot Certification",j.children[b].children[c].children.push({name:f+": "+a.values[c][d],"class":"child"});break;case"engines":f="Total Number of Engines",j.children[b].children[c].children.push({name:f+": "+a.values[c][d],"class":"child"});break;case"aircraft_make":f="Aircraft Make",j.children[b].children[c].children.push({name:f+": "+a.values[c][d],"class":"child"});break;case"aircraft_model":f="Aircraft Model",j.children[b].children[c].children.push({name:f+": "+a.values[c][d],"class":"child"});break;case"hours_airframe":f="Total Airframe Hours",j.children[b].children[c].children.push({name:f+": "+a.values[c][d],"class":"child"});break;case"remarks":f="Remarks",e=a.values[c][d].substring(0,48)+"...",h[e]={date:a.values[c].date,primary_cause:a.key,event_number:c,text:a.values[c][d]},a.values[c].modified_remarks=a.values[c][d].length>47?e:a.values[c][d],j.children[b].children[c].children.push({name:f+": "+a.values[c].modified_remarks,"class":"child"})}}}}),{top:30,right:20,bottom:30,left:20}),l=500-k.left-k.right,m=20,n=.8*l,o=0,p=400,q=d3.layout.tree().nodeSize([0,20]),r=d3.svg.diagonal().projection(function(a){return[a.y,a.x]}),s=d3.select(".cd-panel-content").append("svg").attr("id","flare-tree").attr("width",l+k.left+k.right).append("g").attr("transform","translate("+k.left+","+k.top+")"),t=function(a){a.x0=0,a.y0=0,b(a),c(i=a)};t(j)},a.update=function(){},a}();